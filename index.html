<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ROULETTE ARMORY // AUTHORIZED PERSONNEL ONLY</title>
  <script src="https://cdn.jsdelivr.net/gh/skandhurkat/micronucleus-web@master/lib/micronucleus.js"></script>
  <style>
    :root {
      --bg-color: #050505;
      --term-green: #00ff41;
      --term-dim: #008f11;
      --alert-red: #ff0000;
      --panel-bg: #0a0a0a;
      --border-color: #333;
    }

    /* --- BASE LAYOUT --- */
    body {
      background-color: var(--bg-color);
      color: var(--term-green);
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* --- SCANLINES & GLITCH FX --- */
    body::before {
      content: " ";
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      z-index: 2;
      background-size: 100% 2px, 3px 100%;
      pointer-events: none;
    }

    /* --- HEADER --- */
    header {
      width: 100%;
      padding: 40px 0;
      text-align: center;
      border-bottom: 2px solid var(--term-dim);
      margin-bottom: 20px;
    }

    h1 {
      font-size: 3rem;
      letter-spacing: 10px;
      margin: 0;
      text-shadow: 0 0 10px var(--term-green);
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 1rem;
      color: var(--term-dim);
      letter-spacing: 2px;
      margin-top: 10px;
    }

    /* --- THE MANUAL (COLLAPSIBLE) --- */
    .manual-container {
      width: 90%;
      max-width: 1400px;
      border: 1px solid var(--term-dim);
      margin-bottom: 30px;
      background: #000;
    }

    details {
      padding: 10px;
      cursor: pointer;
    }

    summary {
      font-weight: bold;
      letter-spacing: 2px;
      list-style: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    summary::after { content: "[+]"; }
    details[open] summary::after { content: "[-]"; }

    .manual-content {
      padding: 20px;
      border-top: 1px dashed var(--term-dim);
      color: #ccc;
      line-height: 1.6;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
    }
    
    .manual-column h3 { color: var(--term-green); border-bottom: 1px solid var(--term-dim); padding-bottom: 5px; }
    .manual-column ul { list-style: square; padding-left: 20px; }

    /* --- MAIN ARMORY --- */
    .armory-controls {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      align-items: center;
    }

    select {
      background: #000;
      color: var(--term-green);
      border: 1px solid var(--term-green);
      padding: 10px;
      font-family: inherit;
      text-transform: uppercase;
      cursor: pointer;
    }

    .chamber-grid {
      display: flex;
      gap: 20px;
      width: 95%;
      max-width: 1600px;
      flex: 1;
      margin-bottom: 40px;
    }

    .chamber {
      flex: 1;
      background: var(--panel-bg);
      border: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      transition: 0.3s;
      position: relative;
    }

    .chamber:hover {
      border-color: var(--term-green);
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
    }

    .chamber.dragover {
      border-color: var(--bg-color);
      background: var(--term-green);
    }
    .chamber.dragover * { pointer-events: none; opacity: 0; }
    .chamber.dragover::after {
      content: "DROP PAYLOAD HERE";
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: #000;
      font-weight: bold;
      font-size: 1.5rem;
      opacity: 1;
    }

    .chamber-header {
      background: #111;
      border-bottom: 1px solid #333;
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      letter-spacing: 2px;
    }

    .load-btn {
      cursor: pointer;
      font-size: 0.7rem;
      border: 1px solid #333;
      padding: 2px 6px;
      color: #666;
    }
    .load-btn:hover { color: var(--term-green); border-color: var(--term-green); }

    textarea {
      flex: 1;
      background: #000;
      color: #aaa;
      border: none;
      padding: 15px;
      resize: none;
      font-family: 'Consolas', monospace;
      font-size: 14px;
      line-height: 1.4;
      outline: none;
      min-height: 400px;
    }

    textarea:focus {
      color: #fff;
      background: #080808;
    }

    /* --- TRIGGER MECHANISM --- */
    .trigger-zone {
      width: 100%;
      text-align: center;
      padding-bottom: 50px;
    }

    button#burnBtn {
      background: #000;
      color: var(--term-green);
      border: 2px solid var(--term-green);
      padding: 20px 60px;
      font-size: 1.5rem;
      letter-spacing: 5px;
      cursor: pointer;
      text-transform: uppercase;
      transition: 0.2s;
      position: relative;
      overflow: hidden;
    }

    button#burnBtn:hover {
      background: var(--term-green);
      color: #000;
      box-shadow: 0 0 30px var(--term-green);
    }

    #log {
      margin-top: 20px;
      font-size: 1rem;
      color: #666;
      min-height: 30px;
      text-transform: uppercase;
    }

    /* --- UTILITY --- */
    .warning-text { color: var(--alert-red); }
  </style>
</head>
<body>

  <header>
    <h1>Roulette Armory</h1>
    <div class="subtitle">/// UNIFIED PAYLOAD FABRICATION SYSTEM ///</div>
  </header>

  <div class="manual-container">
    <details>
      <summary>/// FIELD MANUAL (READ BEFORE FIRING)</summary>
      <div class="manual-content">
        <div class="manual-column">
          <h3>THE MECHANISM</h3>
          <p>The BadUSB is a revolver. The barrel holds three bullets. Just like Russian Roulette, except you control the bullet.</p>
          <ul>
            <li><strong>PLUG IN:</strong> Device fires the current chamber.</li>
            <li><strong>UNPLUG:</strong> Device cycles to the next chamber.</li>
            <li><strong>LED FLASH:</strong> Indicates chamber number (1, 2, or 3 blinks).</li>
            <li><strong>SOLID LIGHT:</strong> Armed. You have 3 seconds to unplug before it fires.</li>
          </ul>
        </div>
        <div class="manual-column">
          <h3>OPERATIONAL PROTOCOL</h3>
          <ul>
            <li><strong>LOAD:</strong> Drag .txt or .ino files into the chambers below.</li>
            <li><strong>COMPILE:</strong> Click the [FLASH FIRMWARE] button.</li>
            <li><strong>ARM:</strong> When prompted, plug in your Digispark.</li>
            <li><strong>NOTE:</strong> Total payload size must not exceed 1024 bytes.</li>
          </ul>
        </div>
      </div>
    </details>
  </div>

  <div class="armory-controls">
    <label>HARDWARE CONFIGURATION:</label>
    <select id="hwModel">
      <option value="roulette_single.hex">SINGLE LED (MODEL A / REV 2)</option>
      <option value="roulette_dual.hex">DUAL LED (MODEL B / REV 1)</option>
    </select>
  </div>

  <div class="chamber-grid">
    <div class="chamber" id="box1">
      <div class="chamber-header">
        <span>CHAMBER 01 // WINDOWS</span>
        <span class="load-btn" onclick="triggerFile('file1')">[LOAD FILE]</span>
        <input type="file" id="file1" hidden onchange="loadFile(this, 'c1')">
      </div>
      <textarea id="c1" placeholder="// DRAG FILE HERE OR TYPE CODE&#10;&#10;DELAY 1000&#10;GUI r&#10;DELAY 200&#10;STRING notepad&#10;ENTER"></textarea>
    </div>

    <div class="chamber" id="box2">
      <div class="chamber-header">
        <span>CHAMBER 02 // MAC</span>
        <span class="load-btn" onclick="triggerFile('file2')">[LOAD FILE]</span>
        <input type="file" id="file2" hidden onchange="loadFile(this, 'c2')">
      </div>
      <textarea id="c2" placeholder="// DRAG FILE HERE OR TYPE CODE&#10;&#10;DELAY 1000&#10;GUI SPACE&#10;DELAY 200&#10;STRING Terminal&#10;ENTER"></textarea>
    </div>

    <div class="chamber" id="box3">
      <div class="chamber-header">
        <span>CHAMBER 03 // LINUX</span>
        <span class="load-btn" onclick="triggerFile('file3')">[LOAD FILE]</span>
        <input type="file" id="file3" hidden onchange="loadFile(this, 'c3')">
      </div>
      <textarea id="c3" placeholder="// DRAG FILE HERE OR TYPE CODE&#10;&#10;DELAY 1000&#10;GUI&#10;DELAY 200&#10;STRING firefox&#10;ENTER"></textarea>
    </div>
  </div>

  <div class="trigger-zone">
    <button id="burnBtn">FLASH FIRMWARE</button>
    <div id="log">STATUS: IDLE. AWAITING INPUT.</div>
  </div>

<script>
// --- DRAG & DROP LOGIC ---
['box1', 'box2', 'box3'].forEach((id) => {
  const el = document.getElementById(id);
  const textarea = el.querySelector('textarea');
  
  el.addEventListener('dragover', (e) => { e.preventDefault(); el.classList.add('dragover'); });
  el.addEventListener('dragleave', (e) => { e.preventDefault(); el.classList.remove('dragover'); });
  el.addEventListener('drop', (e) => {
    e.preventDefault();
    el.classList.remove('dragover');
    if (e.dataTransfer.files[0]) readFileInto(e.dataTransfer.files[0], textarea);
  });
});

function triggerFile(id) { document.getElementById(id).click(); }
function loadFile(input, id) { if(input.files[0]) readFileInto(input.files[0], document.getElementById(id)); }
function readFileInto(file, textarea) {
  const reader = new FileReader();
  reader.onload = (e) => textarea.value = e.target.result;
  reader.readAsText(file);
}

// --- COMPILER ENGINE ---
const KEY_MAP = {
  'ENTER':0x28, 'ESC':0x29, 'BACKSPACE':0x2A, 'TAB':0x2B, 'SPACE':0x2C, 'MINUS':0x2D, 
  'EQUAL':0x2E, 'LEFT_BRACE':0x2F, 'RIGHT_BRACE':0x30, 'BACKSLASH':0x31, 'SEMICOLON':0x33, 
  'QUOTE':0x34, 'GRAVE':0x35, 'COMMA':0x36, 'PERIOD':0x37, 'SLASH':0x38, 'CAPS_LOCK':0x39, 
  'F1':0x3A, 'F2':0x3B, 'F3':0x3C, 'F4':0x3D, 'F5':0x3E, 'F6':0x3F, 'F7':0x40, 'F8':0x41, 
  'F9':0x42, 'F10':0x43, 'F11':0x44, 'F12':0x45, 'PRINTSCREEN':0x46, 'SCROLL_LOCK':0x47, 
  'PAUSE':0x48, 'INSERT':0x49, 'HOME':0x4A, 'PAGE_UP':0x4B, 'DELETE':0x4C, 'END
