<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ROULETTE ARMORY</title>
  <script src="https://cdn.jsdelivr.net/gh/skandhurkat/micronucleus-web@master/lib/micronucleus.js"></script>
  <style>
    /* --- CORE AESTHETICS --- */
    body { 
      background: #050505; 
      color: #0f0; 
      font-family: 'Courier New', monospace; 
      margin: 0; 
      padding: 20px; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      min-height: 100vh;
    }

    h1 { 
      font-size: 2rem; 
      letter-spacing: 5px; 
      border-bottom: 2px solid #0f0; 
      padding-bottom: 10px; 
      margin-bottom: 30px; 
      text-shadow: 0 0 10px #0f0;
    }

    /* --- LAYOUT GRID --- */
    .controls {
      margin-bottom: 30px;
      display: flex;
      gap: 20px;
      align-items: center;
    }

    select {
      background: #000;
      color: #0f0;
      border: 1px solid #333;
      padding: 10px 20px;
      font-family: inherit;
      font-size: 1.1rem;
      cursor: pointer;
      outline: none;
    }
    select:hover { border-color: #0f0; }

    .chamber-container { 
      display: flex; 
      width: 95%; 
      max-width: 1600px; 
      gap: 20px; 
      flex: 1;
    }

    /* --- CHAMBER MODULES --- */
    .chamber { 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      background: #0a0a0a; 
      border: 1px solid #333; 
      padding: 0;
      transition: all 0.2s ease;
      position: relative;
    }

    .chamber.dragover {
      border-color: #0f0;
      box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.2);
    }

    .chamber-header {
      background: #111;
      border-bottom: 1px solid #333;
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      letter-spacing: 2px;
    }

    .file-trigger {
      cursor: pointer;
      font-size: 0.8rem;
      opacity: 0.6;
      border: 1px solid #333;
      padding: 2px 8px;
    }
    .file-trigger:hover { opacity: 1; border-color: #0f0; background: #000; }

    textarea { 
      flex: 1; 
      width: 100%; 
      background: #000; 
      color: #ccc; 
      border: none; 
      padding: 15px; 
      font-family: 'Consolas', 'Monaco', monospace; 
      font-size: 14px; 
      line-height: 1.4;
      resize: none; 
      outline: none;
      box-sizing: border-box;
    }
    textarea:focus { color: #fff; background: #080808; }

    /* --- ACTION BAR --- */
    .action-bar {
      margin-top: 30px;
      width: 100%;
      text-align: center;
    }

    button#burnBtn { 
      background: #000; 
      color: #fff; 
      border: 1px solid #fff; 
      padding: 20px 50px; 
      font-size: 20px; 
      cursor: pointer; 
      letter-spacing: 3px;
      transition: 0.2s;
    }
    button#burnBtn:hover { 
      background: #fff; 
      color: #000; 
      box-shadow: 0 0 20px #fff;
    }

    #log { 
      margin-top: 20px; 
      color: #666; 
      white-space: pre-wrap; 
      font-size: 0.9rem;
      min-height: 50px;
    }
  </style>
</head>
<body>

  <h1>/// ROULETTE ARMORY ///</h1>
  
  <div class="controls">
    <label>HARDWARE CONFIG:</label>
    <select id="hwModel">
      <option value="roulette_single.hex">SINGLE LED (Model A)</option>
      <option value="roulette_dual.hex">DUAL LED (Model B)</option>
    </select>
  </div>

  <div class="chamber-container">
    <div class="chamber" id="box1">
      <div class="chamber-header">
        <span>CHAMBER 01</span>
        <span class="file-trigger" onclick="triggerFile('file1')">[LOAD FILE]</span>
        <input type="file" id="file1" hidden onchange="loadFile(this, 'c1')">
      </div>
      <textarea id="c1" placeholder="// DRAG .TXT OR .INO FILE HERE&#10;&#10;DELAY 500&#10;STRING Hello World&#10;ENTER"></textarea>
    </div>

    <div class="chamber" id="box2">
      <div class="chamber-header">
        <span>CHAMBER 02</span>
        <span class="file-trigger" onclick="triggerFile('file2')">[LOAD FILE]</span>
        <input type="file" id="file2" hidden onchange="loadFile(this, 'c2')">
      </div>
      <textarea id="c2" placeholder="// DRAG FILE HERE&#10;&#10;GUI r&#10;DELAY 200&#10;STRING notepad&#10;ENTER"></textarea>
    </div>

    <div class="chamber" id="box3">
      <div class="chamber-header">
        <span>CHAMBER 03</span>
        <span class="file-trigger" onclick="triggerFile('file3')">[LOAD FILE]</span>
        <input type="file" id="file3" hidden onchange="loadFile(this, 'c3')">
      </div>
      <textarea id="c3" placeholder="// DRAG FILE HERE&#10;&#10;GUI SPACE&#10;DELAY 500&#10;STRING Terminal&#10;ENTER"></textarea>
    </div>
  </div>

  <div class="action-bar">
    <button id="burnBtn">COMPILE & FLASH</button>
    <div id="log">Status: READY TO LOAD</div>
  </div>

<script>
// --- DRAG & DROP LOGIC ---
['box1', 'box2', 'box3'].forEach((id, index) => {
  const el = document.getElementById(id);
  const textarea = el.querySelector('textarea');
  
  // Drag Enter/Over
  el.addEventListener('dragover', (e) => {
    e.preventDefault();
    el.classList.add('dragover');
  });

  // Drag Leave
  el.addEventListener('dragleave', (e) => {
    e.preventDefault();
    el.classList.remove('dragover');
  });

  // Drop
  el.addEventListener('drop', (e) => {
    e.preventDefault();
    el.classList.remove('dragover');
    
    const file = e.dataTransfer.files[0];
    if (file) {
      readFileInto(file, textarea);
    }
  });
});

function triggerFile(inputId) {
  document.getElementById(inputId).click();
}

function loadFile(input, textAreaId) {
  if (input.files && input.files[0]) {
    readFileInto(input.files[0], document.getElementById(textAreaId));
  }
}

function readFileInto(file, textarea) {
  const reader = new FileReader();
  reader.onload = (e) => {
    textarea.value = e.target.result;
  };
  reader.readAsText(file);
}

// --- DUCKYSCRIPT COMPILER (UNCHANGED LOGIC) ---
const KEY_MAP = {
  'ENTER':0x28, 'ESC':0x29, 'BACKSPACE':0x2A, 'TAB':0x2B, 'SPACE':0x2C, 'MINUS':0x2D, 
  'EQUAL':0x2E, 'LEFT_BRACE':0x2F, 'RIGHT_BRACE':0x30, 'BACKSLASH':0x31, 'SEMICOLON':0x33, 
  'QUOTE':0x34, 'GRAVE':0x35, 'COMMA':0x36, 'PERIOD':0x37, 'SLASH':0x38, 'CAPS_LOCK':0x39, 
  'F1':0x3A, 'F2':0x3B, 'F3':0x3C, 'F4':0x3D, 'F5':0x3E, 'F6':0x3F, 'F7':0x40, 'F8':0x41, 
  'F9':0x42, 'F10':0x43, 'F11':0x44, 'F12':0x45, 'PRINTSCREEN':0x46, 'SCROLL_LOCK':0x47, 
  'PAUSE':0x48, 'INSERT':0x49, 'HOME':0x4A, 'PAGE_UP':0x4B, 'DELETE':0x4C, 'END':0x4D, 
  'PAGE_DOWN':0x4E, 'RIGHT':0x4F, 'LEFT':0x50, 'DOWN':0x51, 'UP':0x52, 'GUI':0xE3, 'WINDOWS':0xE3,
  'SHIFT':0xE1, 'ALT':0xE2, 'CTRL':0xE0
};

const ASCII_MAP = {
  'a':0x04,'b':0x05,'c':0x06,'d':0x07,'e':0x08,'f':0x09,'g':0x0A,'h':0x0B,'i':0x0C,'j':0x0D,
  'k':0x0E,'l':0x0F,'m':0x10,'n':0x11,'o':0x12,'p':0x13,'q':0x14,'r':0x15,'s':0x16,'t':0x17,
  'u':0x18,'v':0x19,'w':0x1A,'x':0x1B,'y':0x1C,'z':0x1D,'1':0x1E,'2':0x1F,'3':0x20,'4':0x21,
  '5':0x22,'6':0x23,'7':0x24,'8':0x25,'9':0x26,'0':0x27,' ':0x2C
};

function compileDucky(script) {
  const bytes = [];
  const lines = script.split('\n');

  for (let line of lines) {
    line = line.trim();
    if (!line || line.startsWith("REM") || line.startsWith("//") || line.startsWith("#")) continue;
    
    // Simple tokenizer
    const parts = line.split(' ');
